<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="GrocerEaseFinal.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="GrocerEase"
    BackgroundColor="#F4F1E8"
    Shell.NavBarIsVisible="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <x:Double x:Key="MenuDiameter">44</x:Double>
            <x:Double x:Key="IconWidth">20</x:Double>
            <x:Double x:Key="IconHeight">20</x:Double>
            <x:Double x:Key="IconStroke">3</x:Double>
            <Thickness x:Key="MenuPadding">6,8,6,7</Thickness>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid x:Name="PageRoot">

        <Grid x:Name="ContentGrid"
              ColumnDefinitions="444,*"
              ColumnSpacing="40"
              Padding="56,28,56,44"
              BackgroundColor="#F4F1E8">

            <!-- LEFT COLUMN -->
            <Border Grid.Column="0"
                    Padding="16"
                    Stroke="#3A5A40"
                    StrokeThickness="1.5"
                    BackgroundColor="#A3B18A"
                    VerticalOptions="FillAndExpand">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18"/>
                </Border.StrokeShape>

                    <Grid ColumnDefinitions="Auto,*"
                          RowDefinitions="Auto,Auto,*"
                          ColumnSpacing="8"
                          RowSpacing="12"
                          VerticalOptions="FillAndExpand">

                        <!--Bookmark -->
                        <Border Grid.Row="0" Grid.Column="0"
                            WidthRequest="44" HeightRequest="44"
                            BackgroundColor="#588157" StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="22"/>
                            </Border.StrokeShape>
                                <Button x:Name="BookmarkButton"
                                        Grid.Column="0"
                                        Text="🔖"
                                        BackgroundColor="#588157"
                                        SemanticProperties.Hint="Open saved recipes"
                                        WidthRequest="44" HeightRequest="44"
                                        CornerRadius="22"
                                        Clicked="OnBookmarkClick" />
                        </Border>

                        <!-- Generate -->
                        <Button x:Name="GenerateButton"
                                Grid.Row="0" Grid.Column="1"
                                Text="Generate"
                                TextColor="#F3F3E9"
                                Padding="16,10"
                                CornerRadius="22"
                                HorizontalOptions="End"
                                BackgroundColor="#588157"
                                SemanticProperties.Hint="Generate recipes from grocery list"
                                Clicked="OnGenerateClick" />

                        <Label Text="Enter your grocery list"
                               Grid.Row="1" Grid.ColumnSpan="2"
                               FontSize="16"
                               TextColor="#F4F1E8" />

                        <Border Grid.Row="2" Grid.ColumnSpan="2"
                                BackgroundColor="White"
                                Padding="10"
                                StrokeThickness="0"
                                HorizontalOptions="Fill"
                                VerticalOptions="FillAndExpand">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>

                            <Editor x:Name="GroceryEditor"
                                    Placeholder="Type items, one per line..."
                                    PlaceholderColor="#909090"
                                    TextColor="#222222"
                                    AutoSize="Disabled"
                                    Margin="0"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="FillAndExpand" />
                        </Border>
                    </Grid>
            </Border>

            <!-- RIGHT COLUMN -->
            <Grid Grid.Column="1"
                  RowDefinitions="Auto,*"
                  Margin="18,24,24,24"
                  RowSpacing="16">
                <Grid.Resources>
                    <x:Double x:Key="TileHeight">300</x:Double>
                    <Thickness x:Key="TileLabelMargin">0,8,0,0</Thickness>
                </Grid.Resources>

                <BoxView Grid.Column="1"
                         Grid.Row="0"
                         HeightRequest="1"
                         VerticalOptions="End"
                         BackgroundColor="#F4F1E8"
                         Margin="0,0,0,0"/>

            <!-- Search row -->
            <Grid Grid.Row="0"
                  ColumnDefinitions="*,Auto"
                  ColumnSpacing="12"
                  HeightRequest="44"
                  Margin="0"
                  VerticalOptions="Start">
                <Entry x:Name="RecipeSearchBar"
                       Grid.Column="0"
                       Placeholder="Search recipe"
                       HeightRequest="44"
                       Completed="OnRecipeSearchBarCompleted"
                       ReturnType="Search"
                       HorizontalOptions="Fill"
                       VerticalOptions="Center"
                       ClearButtonVisibility="WhileEditing"/>
                <Border Grid.Column="1"
                        x:Name="MenuButton"
                        WidthRequest="44"
                        HeightRequest="44"
                        BackgroundColor="#588157"
                        StrokeThickness="0"
                        HorizontalOptions="End"
                        VerticalOptions="Center"
                        Padding="6,8,6,7"
                        SemanticProperties.Hint="Open menu">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="22" />
                    </Border.StrokeShape>

                    <Path Stroke="White"
                          StrokeThickness="{StaticResource IconStroke}"
                          StrokeLineCap="Round"
                          WidthRequest="{StaticResource IconWidth}"
                          HeightRequest="{StaticResource IconHeight}"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"
                          Data="M 0 3 H 20 M 0 10 H 20 M 0 17 H 20"/>

                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnMenuClick"/>
                    </Border.GestureRecognizers>
                </Border>
            </Grid>

                <ScrollView x:Name="CategoryScroll"
                            Grid.Row="1"
                            Margin="0,28,0,0"
                            VerticalOptions="FillAndExpand"
                            VerticalScrollBarVisibility="Never">
                    <Grid x:Name="CategoryTilesPanel"
                          ColumnSpacing="40"
                          RowSpacing="40">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- High-Protein -->
                        <Grid x:Name="HighProteinGrid"
                              Grid.Row="0" Grid.Column="0"
                              BackgroundColor="Transparent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Border x:Name="HighProteinTile"
                                    Grid.Row="0"
                                    StrokeThickness="0"
                                    HeightRequest="{StaticResource TileHeight}"
                                    BackgroundColor="Transparent">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="20"/>
                                </Border.StrokeShape>
                                <Image Source="highprotein.jpg"
                                       Aspect="AspectFill"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill"/>
                            </Border>
                            <Label Grid.Row="1" Text="High-Protein"
                                   Margin="{StaticResource TileLabelMargin}"
                                   FontAttributes ="Bold"
                                   FontSize="28" TextColor="#99582A" />
                        </Grid>

                        <!-- Low-Carb -->
                        <Grid x:Name="LowCarbGrid"
                              Grid.Row="0" Grid.Column="1"
                              BackgroundColor="Transparent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Border x:Name="LowCarbTile"
                                    Grid.Row="0"
                                    StrokeThickness="0"
                                    HeightRequest="{StaticResource TileHeight}"
                                    BackgroundColor="Transparent">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="20"/>
                            </Border.StrokeShape>
                                <Image Source="lowcarb.jpg"
                                       Aspect="AspectFill"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill"/>
                            </Border>
                            <Label Grid.Row="1" Text="Low-Carb"
                                   Margin="{StaticResource TileLabelMargin}"
                                   FontAttributes="Bold"
                                   FontSize="28" TextColor="#99582A" />
                        </Grid>

                        <!-- Plant-Based -->
                        <Grid x:Name="PlantBasedGrid"
                              Grid.Row="1" Grid.Column="0"
                              BackgroundColor="Transparent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Border x:Name="PlantBasedTile"
                                    Grid.Row="0"
                                    HeightRequest="{StaticResource TileHeight}"
                                    StrokeThickness="0"
                                    BackgroundColor="Transparent">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="20" />
                                </Border.StrokeShape>
                                <Image Source="plantbased.jpg"
                                       Aspect="AspectFill"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill"/>
                            </Border>
                            <Label Grid.Row="1" Text="Plant-Based"
                                   Margin="{StaticResource TileLabelMargin}"
                                   FontAttributes="Bold"
                                   FontSize="28" TextColor="#99582A" />
                        </Grid>

                        <!-- Balanced -->
                        <Grid x:Name="BalancedGrid"
                              Grid.Row="1" Grid.Column="1"
                              BackgroundColor="Transparent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Border x:Name="BalancedTile"
                                    Grid.Row="0"
                                    HeightRequest="{StaticResource TileHeight}"
                                    StrokeThickness="0"
                                    BackgroundColor="Transparent">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="20" />
                                </Border.StrokeShape>
                                <Image Source="balanced.jpg"
                                       Aspect="AspectFill"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill"/>
                            </Border>
                            <Label Grid.Row="1" Text="Balanced"
                                   Margin="{StaticResource TileLabelMargin}"
                                   FontAttributes="Bold"
                                   FontSize="28" TextColor="#99582A" />
                        </Grid>
                    </Grid>
                </ScrollView>

                <CollectionView x:Name="RightResultsCollectionView"
                                Grid.Row="1"
                                IsVisible="False"
                                ItemsLayout="VerticalList"
                                ItemSizingStrategy="MeasureAllItems"
                                VerticalScrollBarVisibility="Never"
                                VerticalOptions="FillAndExpand"
                                HorizontalOptions="Fill"
                                SelectionMode="Single"
                                SelectionChanged="OnResultSelected"
                                Margin="0,28,0,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="100,*"
                                  Padding="10">
                                <Image Source="{Binding ImageUrl}"
                                       WidthRequest="90"
                                       HeightRequest="90"
                                       Aspect="AspectFill"/>
                                <VerticalStackLayout Grid.Column="1"
                                                     Padding="10,0">
                                    <Label Text="{Binding Name}"
                                           FontAttributes="Bold"
                                           FontSize="18"/>
                                    <Label Text="{Binding Category}"
                                           FontSize="14"
                                           TextColor="Gray"/>
                                </VerticalStackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Grid>
        <Grid x:Name="MenuOverlay"
              IsVisible="False"
              InputTransparent="True"
              Opacity="0"
              Grid.ZIndex="1000">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="360"/>
            </Grid.ColumnDefinitions>

            <Grid x:Name="OverlayTapTarget"
                  Grid.Column="0"
                  IsVisible="False"
                  InputTransparent="True"
                  BackgroundColor="#01000000">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnOverlayTapped"/>
                </Grid.GestureRecognizers>
            </Grid>
            <ContentView x:Name="RightDrawerHost"
                         Grid.Column="1"
                         BackgroundColor="#588157"
                         WidthRequest="360"
                         TranslationX="360"
                         Padding="28,100,28,28">
                    <VerticalStackLayout Spacing="28">
                        <Button x:Name="HomeButton"
                                Text="Home"
                                Clicked="OnMenuHome"
                                FontSize="36"
                                TextColor="White"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Start"
                                Padding="0"
                                FontAttributes="Bold"/>
                        <Label x:Name="LoginMenuItem"
                               Text="Log In"
                               FontSize="36"
                               FontAttributes="Bold"
                               TextColor="White">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnMenuLogin" />
                            </Label.GestureRecognizers>
                        </Label>

                        <Button x:Name="GroceryListsButton"
                                Text="Grocery Lists"
                                Clicked="OnMenuGroceryLists"
                                FontSize="36"
                                FontAttributes="Bold"
                                TextColor="White"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Start"
                                Padding="0"
                                IsVisible="False"/>
                        <Button x:Name="RecipesButton"
                                Text="Recipes"
                                Clicked="OnMenuRecipes"
                                FontSize="36"
                                FontAttributes="Bold"
                                TextColor="White"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Start"
                                Padding="0"
                                IsVisible="False"/>
                        <Button x:Name="LogoutButton"
                                Text="Log Out"
                                Clicked="OnMenuLogout"
                                FontSize="36"
                                FontAttributes="Bold"
                                TextColor="White"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Start"
                                Padding="0"
                                IsVisible="False"/>
                    </VerticalStackLayout>
                </ContentView>
        </Grid>
        <Grid x:Name="LoginOverlay"
                  IsVisible="False"
                  BackgroundColor="Transparent"
                  Grid.ZIndex="2000"
                  HorizontalOptions="Fill"
                  VerticalOptions="Fill">

                <BoxView Color="Transparent"
                         ZIndex="0"
                         HorizontalOptions="Fill"
                         VerticalOptions="Fill">
                    <BoxView.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnLoginOverlayTapped"/>
                    </BoxView.GestureRecognizers>
                </BoxView>

                <Grid HorizontalOptions="Center"
                      VerticalOptions="Center"
                      Grid.ZIndex="1">

                    <Border BackgroundColor="#3A5A40"
                            Padding="28"
                            WidthRequest="460"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="28"/>
                        </Border.StrokeShape>
                        <VerticalStackLayout Spacing="18">
                            <Label Text="Log In"
                                   FontSize="32"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center"/>

                            <!-- USERNAME -->
                            <Border BackgroundColor="#F4F1E8"
                                    StrokeThickness="0"
                                    Padding="14,10">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="18"/>
                                </Border.StrokeShape>

                                <Entry x:Name="UsernameEntry"
                                       Placeholder="Username"
                                       PlaceholderColor="#7C8A77"
                                       TextColor="#2B2B2B"/>
                            </Border>

                            <!-- PASSWORD -->
                            <Border BackgroundColor="#F4F1E8"
                                    StrokeThickness="0"
                                    Padding="14,10">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="18"/>
                                </Border.StrokeShape>

                                <Entry x:Name="PasswordEntry"
                                       Placeholder="Password"
                                       IsPassword="True"
                                       PlaceholderColor="#7C8A77"
                                       TextColor="#2B2B2B"/>
                            </Border>

                            <!-- BUTTONS -->
                            <Grid ColumnDefinitions="*,Auto"
                                  ColumnSpacing="18">

                                <Button Text="Cancel"
                                        Clicked="OnLoginCancel"
                                        BackgroundColor="Transparent"
                                        TextColor="#F4F1E8"
                                        FontAttributes="Bold"
                                        HorizontalOptions="Start"/>

                                <Button Text="Log In"
                                        Clicked="OnLoginConfirm"
                                        BackgroundColor="#99582A"
                                        TextColor="White"
                                        FontSize="18"
                                        CornerRadius="26"
                                        Padding="28,14"
                                        HorizontalOptions="End"/>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>
                </Grid>
            </Grid>
    </Grid>
</ContentPage>